<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NMS.TXT - A Text-Based Space Exploration Game</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Header -->
    <header>
        <h1>
            <img src="assets/logo.svg" alt="NMS.TXT" width="68" height="14">
        </h1>
        <div class="header-buttons">
            <button class="panel-toggle" id="mute-btn" aria-label="Mute sounds">mute</button>
            <button class="panel-toggle" id="settings-btn" aria-label="Open settings">settings</button>
        </div>
    </header>

    <!-- Main game area -->
    <main>
        <!-- Narrative display -->
        <div id="narrative" role="article" data-log-number="00000">
            <!-- Game narrative will be displayed here -->
        </div>

        <!-- Dice roll result -->
        <div id="dice-result" class="hidden" role="status" aria-live="polite">
            <!-- Dice results will be displayed here -->
        </div>

        <!-- Action options -->
        <section id="actions">
            <div id="options" role="menu" aria-label="Available actions">
                <!-- Action buttons will be dynamically generated here -->
            </div>

            <!-- Custom action form -->
            <form id="custom-action-form" class="hidden">
                <input
                    type="text"
                    id="custom-action-input"
                    placeholder="Or type your own action..."
                    autocomplete="off"
                    aria-label="Custom action input"
                />
                <button type="submit" id="custom-action-submit" aria-label="Submit custom action">â†’</button>
            </form>
        </section>

        <!-- Error message -->
        <div id="error-message" role="alert" aria-live="assertive"></div>

        <!-- Loading indicator -->
        <div id="loading" role="status" aria-live="polite"></div>

        <!-- Model download progress -->
        <div id="model-loading" class="model-loading-container hidden">
            <div id="model-loading-text">Downloading AI model...</div>
            <div id="model-loading-progress" class="model-loading-progress"></div>
        </div>

        <!-- Info panel -->
        <div id="info-panel" role="status">
            <div class="info-divider-horizontal"></div>
            <div class="info-row">
                <div class="info-item">
                    <div class="info-label">HULL INTEGRITY</div>
                    <div class="info-value" id="ship-health">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">FUEL RESERVES</div>
                    <div class="info-value" id="fuel">0</div>
                </div>
            </div>
            <div class="info-divider-horizontal"></div>
            <div class="info-row">
                <div class="info-item">
                    <div class="info-content">
                        <div class="info-sublabel">LOCATION</div>
                        <div class="info-subvalue" id="location-display">UNKNOWN</div>
                    </div>
                    <div class="info-icon">
                        <img src="assets/location-icon.svg" alt="Location" width="32" height="34">
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-content">
                        <div class="info-sublabel">GALAXY CENTER</div>
                        <div class="info-subvalue" id="distance-display">0 LY</div>
                    </div>
                    <div class="info-icon">
                        <img src="assets/galaxy-icon.svg" alt="Galaxy Center" width="40" height="34">
                    </div>
                </div>
            </div>
            <div class="info-divider-horizontal"></div>
        </div>

        <!-- Skills panel -->
        <div id="skills-panel" class="collapsible-panel">
            <div id="skills-header" class="panel-header" role="button" tabindex="0" aria-expanded="false">
                <span class="panel-label">SKILLS</span>
                <button id="skills-toggle" class="panel-toggle">EXPAND</button>
            </div>
            <div id="skills-content" class="panel-content" aria-hidden="true">
                <!-- Dynamic skill items rendered here -->
            </div>
        </div>

        <!-- Inventory panel -->
        <div id="inventory-panel" class="collapsible-panel">
            <div id="inventory-header" class="panel-header" role="button" tabindex="0" aria-expanded="false">
                <span class="panel-label">INVENTORY [<span id="inventory-count">0</span>]</span>
                <button id="inventory-toggle" class="panel-toggle">EXPAND</button>
            </div>
            <div id="inventory-items" class="panel-content" aria-hidden="true">
                <div class="inventory-item">Empty</div>
            </div>
        </div>

        <!-- Game menu -->
        <div id="game-menu">
            <div class="flex-row">
                <button class="menu-btn primary" id="save-btn">SAVE GAME</button>
                <button class="menu-btn primary" id="load-btn">LOAD GAME</button>
            </div>
            <button class="menu-btn secondary" id="new-game-btn">NEW GAME</button>
        </div>
    </main>

    <!-- API Key Modal -->
    <div id="api-key-modal" class="modal" role="dialog" aria-labelledby="api-key-title">
        <div class="modal-content">
            <h2 id="api-key-title">Enter Claude API Key</h2>
            <p>You've selected Claude API mode, which provides the best narrative quality. You'll need a Claude API key to play.</p>
            <p><strong>Note:</strong> Your API key is stored locally in your browser and is never sent to any server except Anthropic's API. API usage will be billed to your Anthropic account.</p>
            <p><em>Alternatively, you can switch to WebLLM mode in Settings for free, offline gameplay (with simpler narratives).</em></p>
            <label for="api-key-input">API Key:</label>
            <input
                type="password"
                id="api-key-input"
                placeholder="sk-ant-..."
                autocomplete="off"
            />
            <div class="modal-buttons">
                <button class="modal-btn" id="api-key-submit">Start Playing</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal" role="dialog" aria-labelledby="settings-title">
        <div class="modal-content">
            <h2 id="settings-title">Settings</h2>

            <label>AI Model:</label>
            <div class="settings-section">
                <label class="settings-label">
                    <div class="settings-label-header">
                        <input type="radio" name="ai-model" value="claude" id="model-claude" checked>
                        Claude API
                    </div>
                    <div class="settings-description">
                        Best quality, requires API key
                    </div>
                </label>
                <label class="settings-label">
                    <div class="settings-label-header">
                        <input type="radio" name="ai-model" value="webllm" id="model-webllm">
                        WebLLM - Llama 3.2
                    </div>
                    <div class="settings-description">
                        Free, runs in browser, ~2GB download
                    </div>
                </label>
            </div>

            <label for="font-size-select">Font Size:</label>
            <select id="font-size-select">
                <option value="18">Small (18px)</option>
                <option value="20" selected>Medium (20px)</option>
                <option value="22">Large (22px)</option>
                <option value="24">Extra Large (24px)</option>
            </select>

            <label for="narrative-length-select">Narrative Length:</label>
            <select id="narrative-length-select">
                <option value="concise">Concise (~300 chars)</option>
                <option value="regular" selected>Regular (1-2 paragraphs)</option>
            </select>

            <label for="auto-save-toggle">
                <input type="checkbox" id="auto-save-toggle" checked> Enable auto-save
            </label>

            <label for="eink-mode-toggle">
                <input type="checkbox" id="eink-mode-toggle"> E-Ink Mode
            </label>

            <div class="settings-action-section">
                <button class="modal-btn secondary" id="change-api-key-btn">Change API Key</button>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn" id="settings-close">Close</button>
            </div>
        </div>
    </div>

    <!-- Save Game Modal -->
    <div id="save-modal" class="modal" role="dialog" aria-labelledby="save-title">
        <div class="modal-content">
            <h2 id="save-title">Save Game</h2>
            <div id="save-slots">
                <!-- Save slots will be dynamically generated -->
            </div>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="save-cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Load Game Modal -->
    <div id="load-modal" class="modal" role="dialog" aria-labelledby="load-title">
        <div class="modal-content">
            <h2 id="load-title">Load Game</h2>
            <div id="load-slots">
                <!-- Load slots will be dynamically generated -->
            </div>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="load-cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Continue or New Game Modal -->
    <div id="continue-modal" class="modal" role="dialog" aria-labelledby="continue-title">
        <div class="modal-content">
            <h2 id="continue-title">Welcome Back</h2>
            <p>Auto-save detected. Continue your previous game or start a new one?</p>
            <div class="modal-buttons">
                <button class="modal-btn" id="continue-btn">Continue</button>
                <button class="modal-btn secondary" id="start-new-btn">New Game</button>
            </div>
        </div>
    </div>

    <!-- Skill Spending Modal -->
    <div id="skill-spend-modal" class="modal" role="dialog" aria-labelledby="skill-spend-title">
        <div class="modal-content">
            <h2 id="skill-spend-title">Spend Skill Points?</h2>
            <p>Skill: <strong id="skill-name-display">-</strong></p>
            <p>Available Points: <strong id="available-points-display">0</strong></p>
            <p>Spend points to increase your chance of success. Each point spent adds +1 to your dice roll.</p>

            <label for="points-slider">Points to spend:</label>
            <input type="range" id="points-slider" min="0" max="5" value="0" class="slider-container">

            <div class="bonus-display">
                Bonus: +<span id="bonus-display">0</span>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn" id="spend-and-roll-btn">Roll with Bonus</button>
                <button class="modal-btn secondary" id="skip-spend-btn">Roll without Bonus</button>
                <button class="modal-btn secondary" id="cancel-action-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Game Over Modal -->
    <div id="game-over-modal" class="modal" role="dialog" aria-labelledby="game-over-title">
        <div class="modal-content">
            <h2 id="game-over-title">Journey's End</h2>
            <p id="death-message">Your journey has come to an end among the stars.</p>

            <div class="stats-summary">
                <h3>Final Statistics</h3>
                <div class="stat-line">
                    <span>Planets Visited:</span>
                    <span id="final-planets">0</span>
                </div>
                <div class="stat-line">
                    <span>Distance Traveled:</span>
                    <span id="final-distance">0 LY</span>
                </div>
                <div class="stat-line">
                    <span>Resources Gathered:</span>
                    <span id="final-resources">0</span>
                </div>
                <div class="stat-line">
                    <span>Aliens Encountered:</span>
                    <span id="final-aliens">0</span>
                </div>
                <div class="stat-line">
                    <span>Jumps Completed:</span>
                    <span id="final-jumps">0</span>
                </div>
            </div>

            <div class="modal-buttons">
                <button class="modal-btn" id="restart-from-death-btn">Start New Journey</button>
                <button class="modal-btn secondary" id="load-from-death-btn">Load Saved Game</button>
            </div>
        </div>
    </div>

    <!-- Generic Alert Modal -->
    <div id="alert-modal" class="modal" role="dialog" aria-labelledby="alert-title">
        <div class="modal-content">
            <h2 id="alert-title">Notice</h2>
            <p id="alert-message"></p>
            <div class="modal-buttons">
                <button class="modal-btn" id="alert-ok-btn">OK</button>
            </div>
        </div>
    </div>

    <!-- Generic Confirm Modal -->
    <div id="confirm-modal" class="modal" role="dialog" aria-labelledby="confirm-title">
        <div class="modal-content">
            <h2 id="confirm-title">Confirm</h2>
            <p id="confirm-message"></p>
            <div class="modal-buttons">
                <button class="modal-btn" id="confirm-yes-btn">Yes</button>
                <button class="modal-btn secondary" id="confirm-no-btn">No</button>
            </div>
        </div>
    </div>

    <script src="js/game.js"></script>
</body>
</html>
